<!DOCTYPE html>
<html>
<head>
	<title>督办系统</title>
	<meta charset="utf-8">
	<link rel="stylesheet" type="text/css" href="../Css/bootstrap.css">
	<link rel="stylesheet" type="text/css" href="../Css/picker.css">
	<link rel="stylesheet" type="text/css" href="../Css/style.css">
</head>
<body>

		<div class="main">
			<div class="title clearfix">
				<h3 class="caption">新建领导行政会议督查任务</h3>
				<div class="action">
					<button type="button" class="btn btn-default-s"><span class="iconfont icon-sv-download"></span>下载模板</button>
					<button type="button" class="btn btn-default-s"><span class="iconfont icon-sv-import"></span>导入</button>
					<span class="iconfont icon-sv-back"></span>
				</div>
			</div>
			<div class="mission-part">
				<h3 class="mission-title">任务1</h3>
					
			<div class="form-box form-horizontal">
				<a href="javascript:void(0)" class="iconfont icon-sv-reduce trash" style="display:none;"></a>
				
				
					
						<div class="form-group form-customer">
							<label class="col-lg-1 col-sm-1 col-xs-1 col-md-1 control-label">督查编号:</label>
							<div class="col-lg-6 col-sm-6 col-md-6 col-xs-6">
								<select class="form-control dbi">
								  <option>南航集团督</option>
								</select>
								<input type="text" class="form-control dbi num" value="2018" disabled>	
								<input type="text" class="form-control dbi" placeholder="" value="01" disabled>	
								号
							</div>
							<div class="col-lg-5 col-md-5 col-xs-5 col-sm-5">
								<label class="dbi">文件ID</label>
								<input type="text" class="form-control dbi" placeholder="" name="" value="1" disabled>
							</div>
						</div>
					
				
					
						<div class="form-group">
							<label class="col-lg-1 col-md-1 col-sm-1 col-xs-1 control-label">任务内容:</label>
							<div class="col-lg-11 col-md-11 col-sm-11 col-xs-11">
								
									<textarea class="form-control" placeholder="请输入任务内容"></textarea>
								
							</div>
						</div>

					
				
					
						<div class="form-group">
							<label class="col-lg-1 col-md-1 col-sm-1 col-xs-1 control-label">主办单位:</label>
							<div class="col-lg-11 col-md-11 col-sm-11 col-xs-11">
								
									<input type="text" class="form-control" placeholder="请输入主办单位" name="">
									<span class="iconfont icon-sv-add form-control-feedback" data-toggle="modal" data-target="#company" data-tag="leader"></span>
								
							</div>
						</div>

					
				
					
						<div class="form-group">
							<label class="col-lg-1 col-md-1 col-sm-1 col-xs-1 control-label">协办单位:</label>
							<div class="col-lg-11 col-md-11 col-sm-11 col-xs-11">
								
									<input type="text" class="form-control" placeholder="请输入协办单位" name="">
									<span class="iconfont icon-sv-add form-control-feedback" data-toggle="modal" data-target="#company1" data-tag="company"></span>
								
							</div>
						</div>

					
				
					
						<div class="form-group">
							<label class="col-lg-1 col-md-1 col-sm-1 col-xs-1 control-label">完成时限:</label>
							<div class="col-lg-11 col-md-11 col-sm-11 col-xs-11">
								<input type="text" placeholder="请输入完成时限" class="form-control input-time" data-date="" data-date-format="yyyy-mm-dd" data-link-field="search" data-link-format="yyyy-mm-dd">
								<span class="iconfont icon-sv-add form-control-feedback"></span>
							</div>
						</div>
					
				
					
						<div class="form-group">
							<label class="col-lg-1 col-md-1 col-sm-1 col-xs-1 control-label">启动时间:</label>
							<div class="col-lg-11 col-md-11 col-sm-11 col-xs-11">
								<input type="text" placeholder="请输入启动时间" class="form-control input-time" data-date="" data-date-format="yyyy-mm-dd" data-link-field="search" data-link-format="yyyy-mm-dd">
								<span class="iconfont icon-sv-add form-control-feedback"></span>
							</div>
						</div>
					
				
				<div class="form-group tac form-btn">
					<button type="button" class="btn btn-primary-c" data-btn="sure">添加</button>
					<button type="button" class="btn btn-default-c" data-btn="reset">重置</button>
				</div>
			</div>
<div class="modal fade company-modal" tabindex="-1" role="dialog" id="company">
  <div class="modal-dialog" role="document" style="width:610px;">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">选择主办单位</h4>
      </div>
      <div class="modal-body">
        <div class="clearfix">
        	<div class="col-sm-6 col">
        		<div class="form-group">
        			<div class="input-group">
	        		<input type="text" class="form-control" id="leader-input" placeholder="选择部门">
	        		<div class="input-group-addon">
			        	<span class="iconfont icon-sv-search"></span>
			        </div>
			    </div>
			    </div>
        	</div>
             <div class="col-sm-6 col">
             	<div class="form-group dropdown">
             		<div class="input-group">
	        		<input type="text" class="form-control" id="leader-input" placeholder="选择自定义组">
	        		<div class="input-group-addon" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
			        	<span class="iconfont icon-sv-arrow-down"></span>
			        </div>
			        <ul class="dropdown-menu" aria-labelledby="dLabel">
						<li><input type="checkbox" name=""><label>自定义组</label></li>    
						<li><input type="checkbox" name=""><label>自定义组</label></li>    
					</ul>
			    </div>
			    </div>
        	</div>
        </div>
        <div class="choose-area" id="chooseArea">
          
          <ul class="list-unstyled">
            
                <li>
                <div class="checkbox">
                  <label><span class="iconfont icon-sv-user"></span>
                  南航飞行部
                  <input type="checkbox" value="1" /></label></div>
                </li>
              
                <li>
                <div class="checkbox">
                  <label><span class="iconfont icon-sv-user"></span>
                  南航信息中心
                  <input type="checkbox" value="2" /></label></div>
                </li>
              
                <li>
                <div class="checkbox">
                  <label><span class="iconfont icon-sv-user"></span>
                  南航财务部
                  <input type="checkbox" value="4" /></label></div>
                </li>
              
                <li>
                <div class="checkbox">
                  <label><span class="iconfont icon-sv-user"></span>
                  南航飞行保障部
                  <input type="checkbox" value="3" /></label></div>
                </li>
              
                <li>
                <div class="checkbox">
                  <label><span class="iconfont icon-sv-user"></span>
                  南航后勤部
                  <input type="checkbox" value="5" /></label></div>
                </li>
              
                <li>
                <div class="checkbox">
                  <label><span class="iconfont icon-sv-user"></span>
                  南航培训部
                  <input type="checkbox" value="6" /></label></div>
                </li>
              
                <li>
                <div class="checkbox">
                  <label><span class="iconfont icon-sv-user"></span>
                  南航客舱部
                  <input type="checkbox" value="7" /></label></div>
                </li>
              
          </ul>
        </div>
        <div class="result-area" id="resultArea" data-area="">
        </div>
        <div class="form-group tac">
          <button type="button" class="btn btn-primary-c">确定</button>
          <button type="button" class="btn btn-default-c" data-dismiss="modal">重置</button>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="modal fade company-modal" tabindex="-1" role="dialog" id="company1">
  <div class="modal-dialog" role="document" style="width:610px;">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">选择主办单位</h4>
      </div>
      <div class="modal-body">
        <div class="clearfix">
        	<div class="col-sm-6 col">
        		<div class="form-group">
        			<div class="input-group">
	        		<input type="text" class="form-control" id="leader-input" placeholder="选择部门">
	        		<div class="input-group-addon">
			        	<span class="iconfont icon-sv-search"></span>
			        </div>
			    </div>
			    </div>
        	</div>
             <div class="col-sm-6 col">
             	<div class="form-group dropdown">
             		<div class="input-group">
	        		<input type="text" class="form-control" id="leader-input" placeholder="选择自定义组">
	        		<div class="input-group-addon" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
			        	<span class="iconfont icon-sv-arrow-down"></span>
			        </div>
			        <ul class="dropdown-menu" aria-labelledby="dLabel">
						<li><input type="checkbox" name=""><label>自定义组</label></li>    
						<li><input type="checkbox" name=""><label>自定义组</label></li>    
					</ul>
			    </div>
			    </div>
        	</div>
        </div>
        <div class="choose-area" id="chooseArea">
          
          <ul class="list-unstyled">
            
                <li>
                <div class="checkbox">
                  <label><span class="iconfont icon-sv-user"></span>
                  南航飞行部
                  <input type="checkbox" value="1" /></label></div>
                </li>
              
                <li>
                <div class="checkbox">
                  <label><span class="iconfont icon-sv-user"></span>
                  南航信息中心
                  <input type="checkbox" value="2" /></label></div>
                </li>
              
                <li>
                <div class="checkbox">
                  <label><span class="iconfont icon-sv-user"></span>
                  南航财务部
                  <input type="checkbox" value="4" /></label></div>
                </li>
              
                <li>
                <div class="checkbox">
                  <label><span class="iconfont icon-sv-user"></span>
                  南航飞行保障部
                  <input type="checkbox" value="3" /></label></div>
                </li>
              
                <li>
                <div class="checkbox">
                  <label><span class="iconfont icon-sv-user"></span>
                  南航后勤部
                  <input type="checkbox" value="5" /></label></div>
                </li>
              
                <li>
                <div class="checkbox">
                  <label><span class="iconfont icon-sv-user"></span>
                  南航培训部
                  <input type="checkbox" value="6" /></label></div>
                </li>
              
                <li>
                <div class="checkbox">
                  <label><span class="iconfont icon-sv-user"></span>
                  南航客舱部
                  <input type="checkbox" value="7" /></label></div>
                </li>
              
          </ul>
        </div>
        <div class="result-area" id="resultArea" data-area="">
        </div>
        <div class="form-group tac">
          <button type="button" class="btn btn-primary-c">确定</button>
          <button type="button" class="btn btn-default-c" data-dismiss="modal">重置</button>
        </div>
      </div>
    </div>
  </div>
</div>
			</div>
		</div>
		<div id="mission"></div>
		<div class="one-part">
				<span>添加任务</span>
				<span id="newMission" class="iconfont icon-sv-add"></span>
		</div>

<script id="template" type="x-tmpl-mustache">
<div class="mission-part">
	<h3 class="mission-title">任务{{index}}</h3>
			<div class="form-box form-horizontal">
				<a href="javascript:void(0)" class="iconfont icon-sv-reduce trash" style="display:none;"></a>
				
				
					
						<div class="form-group form-customer">
							<label class="col-lg-1 col-sm-1 col-xs-1 col-md-1 control-label">督查编号:</label>
							<div class="col-lg-6 col-sm-6 col-md-6 col-xs-6">
								<select class="form-control dbi">
								  <option>南航集团督</option>
								</select>
								<input type="text" class="form-control dbi" value="2018" disabled>	
								<input type="text" class="form-control dbi" placeholder="" value="01" disabled>	
								号
							</div>
							<div class="col-lg-5 col-md-5 col-xs-5 col-sm-5">
								<label class="dbi">文件ID</label>
								<input type="text" class="form-control dbi" placeholder="" name="" value="1" disabled>
							</div>
						</div>
					
				
					
						<div class="form-group">
							<label class="col-lg-1 col-md-1 col-sm-1 col-xs-1 control-label">任务内容:</label>
							<div class="col-lg-11 col-md-11 col-sm-11 col-xs-11">
								
									<textarea class="form-control" placeholder="请输入任务内容"></textarea>
								
							</div>
						</div>

					
				
					
						<div class="form-group">
							<label class="col-lg-1 col-md-1 col-sm-1 col-xs-1 control-label">主办单位:</label>
							<div class="col-lg-11 col-md-11 col-sm-11 col-xs-11">
								
									<input type="text" class="form-control" placeholder="请输入主办单位" name="">
									<span class="iconfont icon-sv-add form-control-feedback" data-toggle="modal" data-target="#leader" data-tag="leader"></span>
								
							</div>
						</div>

					
				
					
						<div class="form-group">
							<label class="col-lg-1 col-md-1 col-sm-1 col-xs-1 control-label">协办单位:</label>
							<div class="col-lg-11 col-md-11 col-sm-11 col-xs-11">
								
									<input type="text" class="form-control" placeholder="请输入协办单位" name="">
									<span class="iconfont icon-sv-add form-control-feedback" data-toggle="modal" data-target="#company" data-tag="company"></span>
								
							</div>
						</div>

					
				
					
						<div class="form-group">
							<label class="col-lg-1 col-md-1 col-sm-1 col-xs-1 control-label">完成时限:</label>
							<div class="col-lg-11 col-md-11 col-sm-11 col-xs-11">
								<input type="text" placeholder="请输入完成时限" class="form-control input-time" data-date="" data-date-format="yyyy-mm-dd" data-link-field="search" data-link-format="yyyy-mm-dd">
								<span class="iconfont icon-sv-add form-control-feedback"></span>
							</div>
						</div>
					
				
					
						<div class="form-group">
							<label class="col-lg-1 col-md-1 col-sm-1 col-xs-1 control-label">启动时间:</label>
							<div class="col-lg-11 col-md-11 col-sm-11 col-xs-11">
								<input type="text" placeholder="请输入启动时间" class="form-control input-time" data-date="" data-date-format="yyyy-mm-dd" data-link-field="search" data-link-format="yyyy-mm-dd">
								<span class="iconfont icon-sv-add form-control-feedback"></span>
							</div>
						</div>
					
				
				<div class="form-group tac">
					<button type="button" class="btn btn-primary-c" data-btn="sure">确定</button>
					<button type="button" class="btn btn-default-c" data-btn="reset">重置</button>
				</div>
			</div>
</div>
</script>

<script src="../Script/require.js" data-main="../Script/main.js"></script>
</body></html>


<script src="../Script/jquery.js"></script>
<script>
	//弹窗多选
		$('#company').on('shown.bs.modal', function (e) {
			var self = $(e.target).find('.result-area')
			var area = self.data(area)
			if(area.area){
				self.html(area.area.join(';'));
			}else{
				self.empty();
			}
		});
		$('.choose-area li input').on('change', function (e) {
			var self = $(e.target);
			var area = self.closest('.choose-area').next('.result-area').data(area)
			var chooseList = []
			if(area.area){
				chooseList = area.area
			}			
			var val = self.val();
			var text = self.closest('li').find('label').text();
			if (self.is(':checked')) {
				chooseList.push(text)
			} else {
				chooseList.splice(chooseList.indexOf(text), 1);
			}
			area.area = chooseList
			console.log(area)
			self.closest('.choose-area').next('.result-area').data(area)
			createHtml(self.closest('.choose-area').next('.result-area'));
		});
		var createHtml = function(obj) {
			var chooseList = obj.data('area')
			var html = '';
			for(var i = 0,len = chooseList.length;i<len;i++){
				html +='<span>' + chooseList[i] + ';</span>'
			}
			obj.html(html);
		};
		//确认后显示信息
		$(document).on('click','[data-btn="sure"]',function(e){
			var $this = $(e.target)
			var $input = $this.closest('.form-box').find('.form-customer input')
			var $num = $this.closest('.form-box').find('input.num')
			var $area = $this.closest('.form-box').find('textarea')
			var $value = $input.val()
			$('.trash').show()
			$this.closest('.form-box').addClass('form-disabled')
			$this.closest('.form-box').find('.form-control').attr('disabled',true).addClass('disabled').attr('placeholder','')
			$num.val(['【',$num.val(),'】'].join(''))
			console.log($area.val().length)
			$input.each(function(){
				var len = $(this).val().length
				$(this).width(len * (len > 5 ? 10 : 8))
			})
		})
		//点击编辑
		$(document).on('click','.form-group',function(e){
			var $this = $(e.target)
			$this.removeClass('disabled').removeAttr('disabled')
		})
		//离开保存
		$(document).on('blur','.form-group',function(e){
			var $this = $(e.target)
			if($('.form-btn').is(':hidden'))
				$this.addClass('disabled').attr('disabled',true)
		})
		//删除任务
		$(document).on('click','.trash',function(e){
			$(e.target).closest('.mission-part').remove()
		})
		//重置
		$(document).on('click','.form-group',function(e){
			var $this = $(e.target)
			$this.removeClass('disabled').removeAttr('disabled')
		})
</script>